#!/usr/bin/env bash
set -e

echo "ğŸ” Running pre-commit checks..."

# Check for binaries first
if [ -f .husky/check-binaries ]; then
    ./.husky/check-binaries
fi

# Run Go formatting check
echo "ğŸ¨ Checking Go formatting..."
UNFORMATTED=$(gofmt -l .)
if [ -n "$UNFORMATTED" ]; then
    echo "âŒ Go files are not formatted. Run: gofmt -w ."
    echo "$UNFORMATTED"
    exit 1
fi

# Run linting
echo "ğŸ” Running linting..."
if command -v golangci-lint >/dev/null 2>&1; then
    golangci-lint run ./... || {
        echo "âŒ Linting failed. Fix issues above."
        exit 1
    }
fi

# Run tests
echo "ğŸ§ª Running tests..."
go test ./... || {
    echo "âŒ Tests failed. Fix issues above."
    exit 1
}

# Check compilation
echo "ğŸ”¨ Checking compilation..."
go build || {
    echo "âŒ Build failed. Fix compilation errors above."
    exit 1
}

echo "âœ… All pre-commit checks passed!"
